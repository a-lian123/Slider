!function(a){"use strict";a.slider=function(b,c){var d={setting:{imgAry:[],hasDot:!0,isLoop:!1,indexNow:0,isFullScreen:!0,$el:null,autoSlide:!1,hasCloseBtn:!1},$el:null,$close:null,$ul:null,$li:null,$nav:null,$navli:null,$imgs:null,liLength:0,liWidth:0,ulWidth:0,indexNow:0,winWidth:0,winHeight:0,loadNum:0,initFingerDis:0,isScale:!1,isScaling:!1,isSliding:!1,initImgX:0,initImgY:0,lastImgX:0,lastImgY:0,imgMoveX:0,imgMoveY:0,initSlideX:0,initSlideY:0,lastSlideY:0,lastSlideX:0,moveLengthX:0,moveLengthY:0,canMove:void 0,minScale:1,maxScale:3,scaleArg:1,finalScale:1,scale:1,supportOrientation:!1,resizetTimer:null,destoryTimer:null,lastTouchTime:0,isDoubleTap:!1,init:function(a,b){this.$el=this.setting.$el||null,this.supportOrientation="number"==typeof window.orientation&&"object"==typeof window.onorientationchage,this.setting.indexNow>0&&(this.indexNow=this.setting.indexNow),this.liLength=this.setting.imgAry.length||this.$el.find("li").length,this.liLength<2&&(this.setting.isLoop=!1),this.setting.autoSlide&&!this.setting.isFullScreen&&this.liLength>1&&(this.setting.isLoop=!0),this.render(),this.onEvent(),this.autoSlide()},render:function(){this.setting.isFullScreen?this.fullScreenRender():this.notfullScreenRender()},onEvent:function(){var b=this;this.$el.on("touchstart",function(a){b.onTouchEvent.call(b,a)}),this.supportOrientation?a(window).on("orientationchange",function(a){b.updateOrientation.call(b,a)},!1):a(window).resize(function(a){b.updateOrientation.call(b,a)},!1)},fullScreenRender:function(){if(this.$el&&this.$el.length>0)return void this.show();a(window).scrollTop();this.appendStyle();var b='<div class="slide-wrapper" id="J-slide-wrapper"><ul class="slide"></ul><span class="slide-close" id="J-slide-colse">关闭</span></div>';this.$el=a(b),this.$close=this.$el.find("#J-slide-colse"),this.$ul=this.$el.find("ul"),a("body").append(this.$el),this.appendImg(),this.setup(),this.setting.hasCloseBtn||this.$close.hide()},setup:function(){var b=this;if(this.winWidth=a(window).width(),this.winHeight=a(window).height(),this.liWidth=this.setting.isFullScreen?this.winWidth:this.$el.width(),this.$ul=this.$ul||this.$el.find("ul").not(".slide-nav"),this.$li=this.$li||this.$ul.find("li"),this.liLength<3&&this.setting.isLoop&&(this.$ul.append(this.$li.eq(0).clone()),this.$ul.append(this.$li.eq(1).clone()),this.$li=this.$ul.find("li"),this.liLength=this.$li.length),this.$li.width(this.liWidth),this.$li.each(function(c){var d=b.indexNow>c?-b.liWidth:b.indexNow<c?b.liWidth:0;b.transform(0,{x:d,y:0},a(this))}),this.setting.isLoop&&(b.transform(0,{x:-this.liWidth,y:0},this.$li.eq(this.circle(this.indexNow-1))),b.transform(0,{x:this.liWidth,y:0},this.$li.eq(this.circle(this.indexNow+1)))),this.appendStyle(),this.setting.isFullScreen){var c=a(window).scrollTop();this.$el.css({width:this.winWidth,height:this.winHeight,top:c});var d=this.$ul.find("img");d.each(function(a,c){b.initImg(d.eq(a))})}this.appendDot(),this.$el.css("visibility","visible")},circle:function(a){return(this.liLength+a%this.liLength)%this.liLength},notfullScreenRender:function(){this.$el.addClass("slide-wrapper_n"),this.setup()},imgOnload:function(b){this.loadNum++,this.initImg(a(b.target)),this.loadNum==this.liLength&&c&&c()},autoSlide:function(){var a=this;this.setting.autoSlide&&!this.setting.isFullScreen&&(this.timer=setInterval(function(){a.movenext()},3e3))},appendDot:function(){if(this.setting.hasDot&&!this.$navli){this.$el.append('<ul class="slide-nav"></ul>'),this.$nav=this.$el.find(".slide-nav");for(var a=0;a<this.liLength;a++)this.$nav.append("<li></li>");this.$navli=this.$nav.find("li"),this.$navli.eq(this.indexNow).addClass("on")}},appendImg:function(){for(var a="",b=this,c=0;c<this.liLength;c++)a+='<li class="Route"><span class="slide-tips">加载中...</span><img src="'+this.setting.imgAry[c]+'" /></li>';if(2==this.liLength)for(var c=0;c<this.liLength;c++)a+='<li class="Route"><span class="slide-tips">加载中...</span><img src="'+this.setting.imgAry[c]+'" /></li>';this.$ul.append(a),this.$imgs=this.$ul.find("img"),this.$imgs.on("load error emptied stalled",function(a){b.imgOnload.call(b,a)})},initImg:function(a){var b=a[0].naturalHeight,c=a[0].naturalWidth;if(c&&b){if(b>c&&b>this.winWidth){var d=this.winHeight/b,e=this.winWidth/c;e*b>this.winHeight?a.css({width:c*d,height:this.winHeight}):a.css({width:this.winWidth,height:b*e})}else c>b&&c>this.winWidth&&a.css({width:this.winWidth});a.prev().remove(),a.show()}else a.html('<span class="slide-tips">加载失败</span>')},onTouchEvent:function(b){var c=this,d=b.type,e=b.touches||[],f=this.$li.eq(this.indexNow);if(b.preventDefault&&this.setting.isFullScreen&&b.preventDefault(),this.setting.hasCloseBtn&&"J-slide-colse"===a(b.target).attr("id"))return void this.hide();switch(d){case"touchstart":this.doubleTapOrNot(e.length),this.isFullScreen||clearInterval(this.timer),2===e.length&&this.setting.isFullScreen?this.initFingerDis=this.fingersDistance(e):1===e.length&&this.isScale&&!this.isSliding?(this.initImgX=e[0].clientX-this.imgMoveX,this.initImgY=e[0].clientY-this.imgMoveY):1!==e.length||this.isScale||(this.initSlideX=this.lastSlideX=e[0].clientX,this.initSlideY=this.lastSlideY=e[0].clientY,this.moveLength=0),this.$el.on("touchmove touchend",function(a){c.onTouchEvent.call(c,a)});break;case"touchmove":if(2===e.length&&!this.isSliding&&this.setting.isFullScreen){this.isScale=!0,this.isScaling=!0,this.lastFingerDis=this.fingersDistance(e);var g=this.lastFingerDis/this.initFingerDis;this.scale=g*this.finalScale,this.transform(0,{scale:this.scale},this.$li.eq(this.indexNow))}else 1===e.length&&this.isScale&&!this.isSliding?(this.isScaling=!0,this.lastImgX=e[0].clientX,this.lastImgY=e[0].clientY,this.imgMoveX=this.lastImgX-this.initImgX,this.imgMoveY=this.lastImgY-this.initImgY,this.transform(0,{x:this.imgMoveX,y:this.imgMoveY,scale:this.finalScale},f)):1===e.length&&(this.lastSlideX=e[0].clientX,this.lastSlideY=e[0].clientY,this.moveLengthX=this.lastSlideX-this.initSlideX,this.moveLengthY=this.lastSlideY-this.initSlideY,void 0==this.canMove&&(this.canMove=Math.abs(this.moveLengthX)>=Math.abs(this.moveLengthY)),(this.canMove||this.setting.isFullScreen)&&(this.isSliding=!0,b.preventDefault(),this.setting.isLoop?(this.transform(0,{x:-c.liWidth+c.moveLengthX,y:0},this.$li.eq(this.circle(this.indexNow-1))),this.transform(0,{x:c.moveLengthX,y:0},this.$li.eq(this.circle(this.indexNow))),this.transform(0,{x:c.liWidth+c.moveLengthX,y:0},this.$li.eq(this.circle(this.indexNow+1)))):(this.moveLengthX=this.moveLengthX/(!this.indexNow&&this.moveLengthX>0||this.indexNow==this.liLength-1&&this.moveLengthX<0?Math.abs(this.moveLengthX)/this.liWidth+1:1),this.indexNow&&this.transform(0,{x:-c.liWidth+c.moveLengthX,y:0},this.$li.eq(this.indexNow-1)),this.transform(0,{x:c.moveLengthX,y:0},this.$li.eq(this.indexNow)),this.indexNow+1<this.liLength&&this.transform(0,{x:c.liWidth+c.moveLengthX,y:0},this.$li.eq(this.indexNow+1)))));break;case"touchend":this.$el.off("touchmove touchend"),this.tapClose(),this.doubleTap(),this.resetSliderPosition(),this.resetImgPosition(),this.isFullScreen||this.autoSlide(),this.isSliding=!1,this.canMove=void 0,this.moveLengthX=0,this.moveLengthY=0,this.isScaling=!1}},tapClose:function(){var a=this;!this.setting.isFullScreen||this.setting.hasCloseBtn||this.isSliding||this.isScaling||(clearTimeout(this.destoryTimer),this.destoryTimer=setTimeout(function(){a.finalScale=1,a.isScale=!1,a.hide()},250))},doubleTapOrNot:function(a){var b=Date.now(),c=b-(this.lastTouchTime||b);this.lastTouchTime=b,c>0&&250>c&&2>a&&(this.isDoubleTap=!0)},doubleTap:function(){this.isDoubleTap&&this.setting.isFullScreen&&!this.isSliding&&!this.isScaling&&(this.isScale?(this.finalScale=1,this.imgMoveY=0,this.imgMoveX=0,this.isScale=!1):(this.scale=this.finalScale=1.6,this.imgMoveY=0,this.imgMoveX=0,this.isScale=!0),this.transform(3,{x:this.imgMoveX,y:this.imgMoveY,scale:this.finalScale},this.$li.eq(this.indexNow))),this.isDoubleTap&&(clearTimeout(this.destoryTimer),this.isDoubleTap=!1)},resetSliderPosition:function(){var a=null;return function(){if(!this.isScale){var b=this.moveLengthX,c=0!=this.indexNow||this.setting.isLoop,d=this.indexNow!=this.liLength-1||this.setting.isLoop;0>b&&Math.abs(b)>80&&d?this.movenext():b>0&&Math.abs(b)>80&&c?this.moveprev():((this.setting.isLoop||!this.setting.isLoop&&this.indexNow)&&this.transform(3,{x:-this.liWidth,y:0},this.$li.eq(this.circle(this.indexNow-1))),this.transform(3,{x:0,y:0},this.$li.eq(this.indexNow)),(this.setting.isLoop||!this.setting.isLoop&&this.indexNow+1<this.liLength)&&this.transform(3,{x:this.liWidth,y:0},this.$li.eq(this.circle(this.indexNow+1)))),clearTimeout(a)}}}(),resetImgPosition:function(){if(this.isScale){var a=this.$li.eq(this.indexNow).find("img"),b=this.$li.eq(this.indexNow);this.scale<=this.minScale?(this.finalScale=1,this.imgMoveY=0,this.imgMoveX=0,this.transform(3,{scale:1},b),this.isScale=!1):this.finalScale=this.scale;var c=a.width(),d=a.height(),e=(this.winHeight-d)/2;e>0?this.imgMoveY<-e?this.imgMoveY=-e:this.imgMoveY>e&&(this.imgMoveY=e):this.imgMoveY<e?this.imgMoveY=e:this.imgMoveY>-e&&(this.imgMoveY=-e),e=(this.winWidth-c)/2,e>0?this.imgMoveX<-e?this.imgMoveX=-e:this.imgMoveX>e&&(this.imgMoveX=e):this.imgMoveX<e?this.imgMoveX=e:this.imgMoveX>-e&&(this.imgMoveX=-e),this.transform(3,{x:this.imgMoveX,y:this.imgMoveY,scale:this.finalScale},b)}},slide:function(){var a=this;this.movenext(),this.timer=setTimeout(function(){a.slide.call(a)},2e3)},moveprev:function(){(this.setting.isLoop||this.indexNow)&&this.move(this.indexNow-1)},movenext:function(){!this.setting.isLoop&&this.indexNow+1>this.liLength-1||this.move(this.indexNow+1)},move:function(a){var b=Math.abs(this.indexNow-a)/(this.indexNow-a),a=this.circle(a);this.transform(3,{x:this.liWidth*b,y:0},this.$li.eq(this.indexNow)),this.transform(3,{x:0,y:0},this.$li.eq(a)),this.setting.isLoop&&this.transform(0,{x:-this.liWidth*b,y:0},this.$li.eq(this.circle(a-b))),this.indexNow=a,this.setting.hasDot&&(this.$navli.removeClass("on"),this.$navli.eq(a).addClass("on"))},transform:function(a,b,c){c.css({"-webkit-transform":"translate3d("+(b.x||0)+"px, "+(b.y||0)+"px, 0px) scale("+(b.scale||1)+")","-moz-transform":"translate3d("+(b.x||0)+"px, "+(b.y||0)+"px, 0px) scale("+(b.scale||1)+")","-o-transform":"translate3d("+(b.x||0)+"px, "+(b.y||0)+"px, 0px) scale("+(b.scale||1)+")","-ms-transform":"translate3d("+(b.x||0)+"px, "+(b.y||0)+"px, 0px) scale("+(b.scale||1)+")",transform:"translate3d("+(b.x||0)+"px, "+(b.y||0)+"px, 0px) scale("+(b.scale||1)+")","-webkit-transition-duration":"0."+a+"s","-moz-transition-duration":"0."+a+"s","-ms-transition-duration":"0."+a+"s","-o-transition-duration":"0."+a+"s","transition-duration":"0."+a+"s","-webkit-transform-origin":b.origin||"50% 50% 0","-moz-transform-origin":b.origin||"50% 50% 0","-o-transform-origin":b.origin||"50% 50% 0","-ms-transform-origin":b.origin||"50% 50% 0","transform-origin":b.origin||"50% 50% 0"})},fingersDistance:function(a){var b=a[0]||{},c=a[1]||{},d=b.clientX||0,e=c.clientX||0,f=b.clientY||0,g=c.clientY||0,h=Math.abs(d-e),i=Math.abs(f-g);return Math.sqrt(h*h+i*i)},updateOrientation:function(){var a=this;this.supportOrientation?a.setup(!0):(clearTimeout(this.resizetTimer),this.resizetTimer=setTimeout(function(){a.setup(!0)},300))},appendStyle:function(){if(a("#J_slide-style").length<=0){var b=a('<style id="J_slide-style">.slide-wrapper{display:none}.slide-wrapper li,.slide-wrapper ul{padding:0;margin:0}.slide-wrapper{overflow:hidden;margin-bottom:20px;background:rgba(0,0,0,.7);display:none;position:absolute;left:0;top:0;width:100%;height:100%}.slide-wrapper .slide{height:100%;position:absolute;left:0;top:0}.slide-wrapper li{width:100%;height:100%;position:absolute;left:0;top:0;list-style:none}.slide-wrapper p{padding-left:5px;font-size:16px;line-height:20px;margin:0}.slide-wrapper img{display:block;position:absolute;left:50%;top:50%;display:none;transform-origin:50% 50%;-webkit-transform-origin:50% 50%;-ms-transform-origin:50% 50%;-moz-transform-origin:50% 50%;-o-transform-origin:50% 50%;transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);-webkit-transform:translate(-50%,-50%);-o-transform:translate(-50%,-50%);-moz-transform:translate(-50%,-50%)}.slide-nav{position:absolute;left:50%;bottom:1px;transform:translateX(-50%);-ms-transform:translateX(-50%);-webkit-transform:translateX(-50%);-o-transform:translateX(-50%);-moz-transform:translateX(-50%);z-index:100;background:0 0}.slide-nav li{position:static;display:inline-block;margin:3px;border-radius:100px;opacity:.8;background:rgba(255,255,255,.6);width:5px;height:5px}.slide-nav li.on{background:rgba(255,255,255,1)}.slide-tips{position:absolute;top:50%;color:#fff;height:20px;width:100%;margin-top:-10px;line-height:20px;display:block;text-align:center;z-index:100}.slide-nav{position:absolute;left:50%;bottom:1px;transform:translateX(-50%);-ms-transform:translateX(-50%);-webkit-transform:translateX(-50%);-o-transform:translateX(-50%);-moz-transform:translateX(-50%);z-index:100;background:0}.slide-nav li{display:inline-block;margin:3px;border-radius:100px;opacity:.8;background:rgba(255,255,255,.6);width:5px;height:5px}.slide-nav li.on{background:rgba(255,255,255,1)}#J-slide-colse{display:block;width:15%;height:25px;color:#fff;text-align:center;line-height:25px;position:absolute;bottom:5%;left:10px;border-radius:3px;z-index:10000;border:1px solid #3079ed;background-color:#4d90fe}.slide-wrapper_n{overflow:hidden;visibility:hidden}.slide-wrapper_n li,.slide-wrapper_n ul{margin:0;padding:0}.slide-wrapper_n ul{width:100%;position:relative;left:0;top:0}.slide-wrapper_n li{position:absolute;left:0;top:0;list-style:none}.slide-wrapper_n .slide-nav{position:absolute;width:auto;left:50%;bottom:1px;top:auto;transform:translateX(-50%);-ms-transform:translateX(-50%);-webkit-transform:translateX(-50%);-o-transform:translateX(-50%);-moz-transform:translateX(-50%);z-index:100;background:none}.slide-wrapper_n .slide-nav li{position:static;float:left;margin:3px;border-radius:100px;opacity:0.8;background:rgba(255,255,255,0.6);width:5px;height:5px}.slide-wrapper_n .slide-nav li.on{background:rgba(255,255,255,1)}</style>');a("head").append(b)}},destory:function(a){this.$close&&(this.$close.off("touchstar"),this.$close=null),this.$imgs&&(this.$imgs.off("load error emptied stalled"),this.$imgs=null),this.$el&&(this.$el.off("touchstar touchmove touchend").remove(),this.$el=null)},hide:function(){this.$el.hide()},show:function(a){void 0!=a&&(this.indexNow=a),this.setup(),this.$el.show()}};return a.extend(d.setting,b||{}),d.init(),d}}(window.Zepto);