(function(a){a.slider=function(b,d){var c={setting:{imgAry:[],hasDot:true,isLoop:false,indexNow:0},init:function(f,g){var e=this;this.$el=null;this.$close=null;
this.$ul=null;this.$li=null;this.$nav=null;this.$navli=null;this.$imgs=null;this.liLength=this.setting.imgAry.length;this.liWidth=0;this.ulWidth=0;this.indexNow=this.setting.indexNow||0;
this.winWidth=a(window).width();this.winHeight=a(window).height();this.loadNum=0;this.initFingerDis=0;this.isScale=false;this.isMove=false;this.initImgMoveX=0;
this.initImgMoveY=0;this.lastImgMoveX=0;this.lastImgMoveY=0;this.lastSlideX=0;this.initSlideX=0;this.minScale=1.3;this.maxScale=3;this.scaleArg=1;this.finalScale=1;
this.moveX=0;this.moveY=0;this.scale=1;this.render();this.onEvent();},onload:function(f){this.loadNum++;this.initImg(a(f.target));
if(this.loadNum==this.liLength){if(d){d();}}},render:function(){var g=this;var f='<div class="slide-wrapper" id="J-slide-wrapper"><ul class="slide"></ul><ul class="slide-nav"></ul><span class="slide-close" id="J-slide-colse">关闭</span></div>';
this.$el=a(f);this.$close=this.$el.find("#J-slide-colse");this.$ul=this.$el.find(".slide");this.$nav=this.$el.find(".slide-nav");this.liWidth=this.winWidth;
this.ulWidth=this.setting.isLoop?this.liWidth*(this.liLength+2):this.liWidth*this.liLength;a("body").append(this.$el);this.appendImg();if(this.setting.hasDot){for(var e=0;
e<this.liLength;e++){this.$nav.append("<li></li>");}this.$navli=this.$el.find(".slide-nav li");this.$navli.eq(0).addClass("on");}var h=a("body").scrollTop();
this.$el.css({width:this.winWidth,height:this.winHeight,top:h}).show();this.$ul.css({width:this.ulWidth+"px"});if(this.setting.isLoop){this.$ul.css("left",-this.liWidth+"px");
}this.transform(0,-(this.indexNow)*this.liWidth,0,1,"auto",this.$ul);if(this.setting.hasDot){this.$navli.removeClass("on");this.$navli.eq(this.indexNow).addClass("on");
}this.$li=this.$el.find(".slide li");this.$li.css({width:this.liWidth+"px"});},appendImg:function(){var f="",g=this;for(var e=0;e<this.liLength;e++){if(e==0&&this.setting.isLoop){f+='<li class="Route"><span class="slide-tips">加载中...</span><img src="'+this.setting.imgAry[this.liLength-1]+'" /></li>';
}f+='<li class="Route"><span class="slide-tips">加载中...</span><img src="'+this.setting.imgAry[e]+'" /></li>';if(e==this.liLength-1&&this.setting.isLoop){f+='<li class="Route"><span class="slide-tips">加载中...</span><img src="'+this.setting.imgAry[0]+'" /></li>';
}}this.$ul.append(f);this.$imgs=this.$ul.find("img");this.$imgs.on("load error emptied stalled",function(h){g.onload.call(g,h);});},initImg:function(f){var e=f[0].naturalHeight;
var g=f[0].naturalWidth;if(!(g&&e)){f.html('<span class="slide-tips">加载失败</span>');}else{if(e>g){var i=this.winHeight/e;var h=this.winWidth/g;if(h*e>this.winHeight){f.css({width:g*i,height:this.winHeight});
}else{f.css({width:this.winWidth,height:e*h});}}f.prev().remove();f.show();}},onEvent:function(){var e=this;this.$el.on("touchstart doubleTap",function(f){e.onTouchEvent.call(e,f);
});},onTouchEvent:function(j){var h=this,g=j.type,i=j.touches||[],l=this.setting.isLoop?this.$li.eq(this.indexNow+1):this.$li.eq(this.indexNow),k=0;if(j.preventDefault){j.preventDefault();
}if(a(j.target).attr("id")==="J-slide-colse"){this.destory();return;}switch(g){case"touchstart":if(i.length===2){this.initFingerDis=this.fingersDistance(i);
this.isScale=true;}else{if(i.length===1&&this.isScale&&!this.isMove){this.initImgMoveX=i[0].clientX-this.moveX;this.initImgMoveY=i[0].clientY-this.moveY;
}else{if(i.length===1&&!this.isScale){this.initSlideX=this.lastSlideX=i[0].clientX;this.moveLength=0;}}}this.$el.on("touchmove touchend",function(m){h.onTouchEvent.call(h,m);
});break;case"touchmove":if(i.length===2&&!this.isMove){this.lastFingerDis=this.fingersDistance(i);var f=this.lastFingerDis/this.initFingerDis;
this.scale=f*this.finalScale;this.transform(0,0,0,this.scale,"50% 50%",l);}else{if(i.length===1&&this.isScale&&!this.isMove){this.lastImgMoveX=i[0].clientX;
this.lastImgMoveY=i[0].clientY;this.moveX=this.lastImgMoveX-this.initImgMoveX,this.moveY=this.lastImgMoveY-this.initImgMoveY;this.transform(0,this.moveX,this.moveY,this.finalScale,"50% 50%",l);
}else{if(i.length===1){this.isMove=true;this.lastSlideX=i[0].clientX;this.moveLength=this.lastSlideX-this.initSlideX;this.transform(0,(-h.indexNow*h.liWidth+h.moveLength),0,1,"auto",this.$ul);
}}}break;case"touchend":this.$el.off("touchmove touchend");this.resetSliderPosition();this.resetImgPosition(l);this.$el.off("touchmove touchend");
break;case"doubleTap":if(this.isScale){this.finalScale=1;this.moveY=0;this.moveX=0;this.transform(3,0,0,1,"50% 50%",l);this.isScale=false;}break;}},resetSliderPosition:function(){if(!this.isMove){return;
}var e=this.moveLength;var f=this.indexNow!=0||this.setting.isLoop,g=this.indexNow!=this.liLength-1||this.setting.isLoop;if(e<0&&Math.abs(e)>this.liWidth/3&&g){
this.movenext();}else{if(e>0&&Math.abs(e)>this.liWidth/3&&f){this.moveprev();}else{this.transform(3,-(this.indexNow)*this.liWidth,0,1,"auto",this.$ul);
}}this.isMove=false;},resetImgPosition:function(h){if(!this.isScale){return;}var g=h.find("img");if(this.scale<=this.minScale){this.finalScale=1;this.moveY=0;
this.moveX=0;this.transform(3,0,0,1,"50% 50%",h);this.isScale=false;}else{this.finalScale=this.scale;}var f=g.width(),e=g.height();var i=(this.winHeight-e)/2;
if(i>0){if(this.moveY<-i){this.moveY=-i;}else{if(this.moveY>i){this.moveY=i;}}}else{if(this.moveY<i){this.moveY=i;}else{if(this.moveY>-i){this.moveY=-i;
}}}i=(this.winWidth-f)/2;if(i>0){if(this.moveX<-i){this.moveX=-i;}else{if(this.moveX>i){this.moveX=i;}}}else{if(this.moveX<i){this.moveX=i;}else{if(this.moveX>-i){this.moveX=-i;
}}}this.transform(3,this.moveX,this.moveY,this.finalScale,"50% 50%",h);},slide:function(){var e=this;this.movenext();this.timer=setTimeout(function(){e.slide.call(e);
},2000);},moveprev:function(){var e=this;this.indexNow--;this.transform(2,-(this.indexNow)*this.liWidth,0,1,"auto",this.$ul);if(this.indexNow<0&&this.setting.isLoop){this.indexNow=this.liLength-1;
setTimeout(function(){e.transform(0,-(e.indexNow)*e.liWidth,0,1,"auto",e.$ul);},200);}if(this.setting.hasDot){this.$navli.removeClass("on");this.$navli.eq(this.indexNow).addClass("on");
}},movenext:function(){var e=this;this.indexNow++;this.transform.call(this,2,-(this.indexNow)*this.liWidth,0,1,"auto",this.$ul);if(this.indexNow>=this.liLength&&this.setting.isLoop){this.indexNow=0;
setTimeout(function(){e.transform(0,0,0,1,"auto",e.$ul);},200);}if(this.setting.hasDot){this.$navli.removeClass("on");this.$navli.eq(this.indexNow).addClass("on");
}},transform:function(i,h,g,j,f,e){e.css({transform:"translate3d("+h+"px, "+g+"px, 0px) scale("+j+")","-webkit-transform":"translate3d("+h+"px, "+g+"px, 0px) scale("+j+")",transition:"all 0."+i+"s cubic-bezier(0.22, 0.69, 0.72, 0.88)","-webkit-transition":"all 0."+i+"s cubic-bezier(0.22, 0.69, 0.72, 0.88)","transform-origin":f,"-webkit-transform-origin":f});
},fingersDistance:function(g){var i=g[0]||{},h=g[1]||{},f=i.clientX||0,e=h.clientX||0,k=i.clientY||0,j=h.clientY||0,m=Math.abs(f-e),l=Math.abs(k-j);return Math.sqrt(m*m+l*l);
},destory:function(f){if(this.$close){this.$close.off("touchstar");this.$close=null;}if(this.$imgs){this.$imgs.off("load error emptied stalled");this.$imgs=null;
}if(this.$el){this.$el.off("touchstar touchmove touchend").remove();this.$el=null;}},handleData:function(e){this.setting.imgAry=e();}};a.extend(c.setting,b||{});
c.init();return this;};})(window.Zepto);